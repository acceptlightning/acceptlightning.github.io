"use strict";document.addEventListener("DOMContentLoaded",async function(){if(document.cookie.split(";").filter(function(item){return item.trim().indexOf("acceptlightning=")==0}).length){async function getUserBalance(userID){const getUserBalanceResponse=await jsonrpc("getUserBalance",{version:1,userID:userID});return getUserBalanceResponse["balance"]}function timeout(milliseconds){return new Promise(function(resolve){setTimeout(resolve,milliseconds)})}async function getLightningResponse(lightningRequestID){const response=await jsonrpc("getLightningResponse",{version:1,lightningRequestID:lightningRequestID});if("responseStatus"in response&&response["responseStatus"]==="Pending"){await timeout(5e3);console.log(response);return getLightningResponse(lightningRequestID)}else{return response}}async function pay(userID,bolt11){const payResponse=await jsonrpc("pay",{version:1,userID:userID,bolt11:bolt11});const lightningResponse=await getLightningResponse(payResponse["lightningRequestID"]);return{payResponse:payResponse,lightningResponse:lightningResponse}}function generateRandomID(){const arr=new Uint32Array(1);window.crypto.getRandomValues(arr);return arr[0].toString()}function jsonrpc(method,params){const url="https://speedoflightning.com";return new Promise(function(resolve,reject){const xhr=new XMLHttpRequest;xhr.open("POST",url);xhr.setRequestHeader("Content-Type","application/json");const id=generateRandomID();xhr.onload=function(){if(xhr.status===200){const response=JSON.parse(xhr.responseText);if("result"in response){resolve(response["result"])}else if("error"in response&&"message"in response["error"]){reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"lightning",message:response["error"]["message"]})}else{reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"unknown",message:xhr.responseText})}}else{reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"xhr.status",message:xhr.status})}};xhr.timeout=8e3;xhr.ontimeout=function(){reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"timeout",message:"timeout"})};xhr.send(JSON.stringify({jsonrpc:"2.0",id:id,method:method,params:params}))})}const userID=JSON.parse(document.cookie.replace(/(?:(?:^|.*;\s*)acceptlightning\s*\=\s*([^;]*).*$)|^.*$/,"$1"))["userID"];try{const balance=await getUserBalance(userID);if(balance==0){document.getElementById("earn").style.display="block";document.getElementById("withdraw").style.display="none"}else{document.getElementById("earn").style.display="none";document.getElementById("withdraw").style.display="block";const balanceSatoshis=parseInt(balance)*.001;if(balanceSatoshis==1){document.getElementById("balanceInvoice").innerHTML=" "+balanceSatoshis+" satoshi "}else{document.getElementById("balanceInvoice").innerHTML=" "+balanceSatoshis+" satoshis "}}}catch(error){if("jsonrpcerror"in error){document.getElementById("error").innerHTML+="Error "+error["method"]+": "+error["message"]+"<br>";document.getElementById("error").style.display="block"}}const withdrawButton=document.getElementById("withdrawButton");withdrawButton.addEventListener("click",async function(event){try{withdrawButton.setAttribute("disabled","");document.getElementById("withdrawResult").innerHTML="Pending...";const bolt11=document.getElementById("bolt11").value;const payValue=await pay(userID,bolt11);withdrawButton.removeAttribute("disabled");const balance=await getUserBalance(userID);document.getElementById("earn").style.display="none";document.getElementById("withdraw").style.display="block";const balanceSatoshis=parseInt(balance)*.001;if(balanceSatoshis==1){document.getElementById("balanceInvoice").innerHTML=" "+balanceSatoshis+" satoshi "}else{document.getElementById("balanceInvoice").innerHTML=" "+balanceSatoshis+" satoshis "}if("lightningResponse"in payValue&&payValue["lightningResponse"]["status"]==="complete"){document.getElementById("withdrawResult").innerHTML="Success!";document.getElementById("bolt11").value=""}}catch(error){if("jsonrpcerror"in error){withdrawButton.removeAttribute("disabled");document.getElementById("error").innerHTML+="Error "+error["method"]+": "+error["message"]+"<br>";document.getElementById("error").style.display="block"}if("jsonrpcerror"in error&&error["method"]==="pay"){document.getElementById("withdrawResult").innerHTML=""}}})}else{document.getElementById("earn").style.display="block";document.getElementById("withdraw").style.display="none"}});
