"use strict";document.addEventListener("DOMContentLoaded",function(){let userID="";if(document.cookie===""){userID=generateRandomID();document.cookie=JSON.stringify({userID:userID})}else{userID=JSON.parse(document.cookie)["userID"]}const nextAdButton=document.getElementById("nextAdButton");nextAdButton.addEventListener("click",function(event){getNextAd(userID)});const adImg=document.getElementById("adImg");adImg.addEventListener("load",function(){populateUserBalance(userID);setTimeout(function(){nextAdButton.removeAttribute("disabled")},2e3)});adImg.addEventListener("error",function(){nextAdButton.removeAttribute("disabled")});populateUserBalance(userID);getNextAd(userID);function generateRandomID(){const arr=new Uint32Array(1);window.crypto.getRandomValues(arr);return arr[0].toString()}function jsonrpc(url,method,params){return new Promise(function(resolve,reject){const xhr=new XMLHttpRequest;xhr.open("POST",url);xhr.setRequestHeader("Content-Type","application/json");const id=generateRandomID();xhr.onload=function(){if(xhr.status===200){const response=JSON.parse(xhr.responseText);if("result"in response){resolve(response["result"])}else if("error"in response&&"message"in response["error"]){reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"lightning",message:response["error"]["message"]})}else{reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"unknown",message:xhr.responseText})}}else{reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"xhr.status",message:xhr.status})}};xhr.timeout=8e3;xhr.ontimeout=function(){reject({jsonrpcerror:"2.0",url:url,method:method,params:params,type:"timeout",message:"timeout"})};xhr.send(JSON.stringify({jsonrpc:"2.0",id:id,method:method,params:params}))})}async function getNextAd(userID){try{const getNextAdResponse=await jsonrpc("https://speedoflightning.com","getNextAd",{version:1,userID:userID});const nextAdButton=document.getElementById("nextAdButton");nextAdButton.setAttribute("disabled","");adImg.src=getNextAdResponse["nextAdImg"];document.getElementById("adLink").href=getNextAdResponse["nextAdLink"]}catch(error){if("jsonrpcerror"in error){document.getElementById("error").innerHTML+="Error "+error["method"]+": "+error["message"]+"<br>";document.getElementById("error").style.display="block"}}}async function getUserBalance(userID){const getUserBalanceResponse=await jsonrpc("https://speedoflightning.com","getUserBalance",{version:1,userID:userID});return getUserBalanceResponse["balance"]}async function populateUserBalance(userID){try{const balance=await getUserBalance(userID);const balanceSatoshis=parseInt(balance)*.001;if(balanceSatoshis==1){document.getElementById("balance").innerHTML=" "+balanceSatoshis+" satoshi"}else{document.getElementById("balance").innerHTML=" "+balanceSatoshis+" satoshis"}}catch(error){if("jsonrpcerror"in error){document.getElementById("error").innerHTML+="Error "+error["method"]+": "+error["message"]+"<br>";document.getElementById("error").style.display="block"}}}});
