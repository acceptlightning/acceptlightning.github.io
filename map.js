function mapCallback(){window.map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:2,mapTypeControl:false});const searchInput=document.getElementById("search");const searchBox=new google.maps.places.SearchBox(searchInput);window.map.controls[google.maps.ControlPosition.TOP_LEFT].push(searchInput);window.map.addListener("bounds_changed",()=>{searchBox.setBounds(window.map.getBounds())});searchBox.addListener("places_changed",()=>{const places=searchBox.getPlaces();if(places.length===0){return}const bounds=new google.maps.LatLngBounds;places.forEach(place=>{if(place.geometry.viewport){bounds.union(place.geometry.viewport)}else{bounds.extend(place.geometry.location)}});window.map.fitBounds(bounds)});$.ajax({url:"merchants.json",success:merchants=>{let previousInfoWindow=new google.maps.InfoWindow;merchants.filter(merchant=>{return merchant.location.hasOwnProperty("latlong")}).forEach((merchant,i)=>{const marker=new google.maps.Marker({position:merchant.location.latlong,map:window.map});const merchantNameAndService=`<div><a id="merchant${i}" href="#">${merchant.name}</a></div><div>${merchant.service}</div>`;const infoWindow=new google.maps.InfoWindow({content:merchantNameAndService});infoWindow.addListener("domready",()=>{$(`#merchant${i}`).click(event=>{event.preventDefault();$("#merchantModal").modal();$("#merchantModalTitle").text(merchant.name);let modalContent=`<div>${merchant.service}</div>`;if(merchant.location.hasOwnProperty("url")){modalContent+=`<div><a target="_blank" href="${merchant.location.url}">${merchant.location.url}</a></div>`}if(merchant.location.hasOwnProperty("city")){modalContent+=`<div>${merchant.location.city}</div>`}$("#merchantModalContent").html(modalContent);window.map.setCenter(marker.getPosition());window.map.setZoom(15)})});marker.addListener("click",()=>{previousInfoWindow.close();previousInfoWindow=infoWindow;infoWindow.open(window.map,marker)})})}})}
