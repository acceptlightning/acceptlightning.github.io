"use strict";document.addEventListener("DOMContentLoaded",function(){$("#tipMeButton").popover();let bolt11="";const tipMeButton=document.getElementById("tipMeButton");tipMeButton.addEventListener("click",function(event){if(bolt11===""){invoice(1e7,"tip",2400).then(function(result){let backOffTimeout=4e3;let pollCount=0;const getInvoicePoll=async function(invoiceLabel){if(bolt11===""){bolt11=result["lightningResponse"]["bolt11"];tipMeButton.setAttribute("data-content",bolt11);$("#tipMeButton").data("bs.popover").setContent();$("#tipMeButton").data("bs.popover").update()}const getInvoiceResponse=await getInvoice(invoiceLabel);const paid=getInvoiceResponse["lightningResponse"]["invoices"][0]["status"];const expiresAt=getInvoiceResponse["lightningResponse"]["invoices"][0]["expires_at"];console.log("Paid:",paid,"Expires At: ",new Date(expiresAt*1e3));await timeout(backOffTimeout);backOffTimeout*=2;pollCount++;if(pollCount<10){getInvoicePoll(invoiceLabel)}};getInvoicePoll(result["invoiceResponse"]["invoiceLabel"])})}});async function invoice(msatoshi,description,expiry){const invoiceResponse=await jsonrpc("https://speedoflightning.com","invoice",{version:1,msatoshi:msatoshi,description:description,expiry:expiry});const lightningResponse=await getLightningResponse(invoiceResponse["lightningRequestID"]);return{invoiceResponse:invoiceResponse,lightningResponse:lightningResponse}}async function getInvoice(invoiceLabel){const getInvoiceResponse=await jsonrpc("https://speedoflightning.com","getInvoice",{version:1,invoiceLabel:invoiceLabel});const lightningResponse=await getLightningResponse(getInvoiceResponse["lightningRequestID"]);return{getInvoiceResponse:getInvoiceResponse,lightningResponse:lightningResponse}}function timeout(milliseconds){return new Promise(function(resolve){setTimeout(resolve,milliseconds)})}async function getLightningResponse(lightningRequestID){const response=await jsonrpc("https://speedoflightning.com","getLightningResponse",{version:1,lightningRequestID:lightningRequestID});if("responseStatus"in response&&response["responseStatus"]==="Pending"){await timeout(5e3);console.log(response);return getLightningResponse(lightningRequestID)}else{return response}}function generateRandomID(){const arr=new Uint32Array(1);window.crypto.getRandomValues(arr);return arr[0].toString()}function jsonrpc(url,method,params){return new Promise(function(resolve,reject){const xhr=new XMLHttpRequest;xhr.open("POST",url);xhr.setRequestHeader("Content-Type","application/json");const id=generateRandomID();xhr.onload=function(){if(xhr.status===200){const response=JSON.parse(xhr.responseText);if("result"in response){resolve(response["result"])}else if("error"in response){reject(response["error"])}else{reject(response)}}else{reject({id:id,error:xhr.status})}};xhr.send(JSON.stringify({jsonrpc:"2.0",id:id,method:method,params:params}))})}});
